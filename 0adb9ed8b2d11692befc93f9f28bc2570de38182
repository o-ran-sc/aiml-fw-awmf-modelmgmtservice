{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "8353242b_4843bbcf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1001948
      },
      "writtenOn": "2025-08-26T08:21:32Z",
      "side": 1,
      "message": "TargetEnvironment Addition approach seems fine!!",
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "f9598376_f78d3e02",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2025-09-01T01:09:49Z",
      "side": 1,
      "message": "All the revisions have been applied. PTAL. @subh.singh@samsung.com",
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e3af43de_da81193c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1000475
      },
      "writtenOn": "2025-09-01T09:34:31Z",
      "side": 1,
      "message": "Sure , I will discuss the patch with Ashish and we will revert back.",
      "parentUuid": "f9598376_f78d3e02",
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3d7cd341_3cd1b73f",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1001948
      },
      "writtenOn": "2025-09-01T11:48:13Z",
      "side": 1,
      "message": "Hi,\nI performed a fresh installation of AIMLFW today and tested your patch. While running through the setup, I encountered the following issues:\nA: During the model registration step, \nI used the following cURL command:\n```bash\ncurl --location \u0027localhost:32006/ai-ml-model-registration/v1/model-registrations/\u0027 \\\n--header \u0027Content-Type: application/json\u0027 \\\n--data \u0027{\n    \"modelId\": {\n        \"modelName\": \"test-model-target-env\",\n        \"modelVersion\" : \"1\"\n    },\n    \"description\": \"hello world2\",\n    \"modelInformation\": {\n        \"metadata\": {\n            \"author\": \"someone\"\n        },\n        \"inputDataType\": \"pdcpBytesDl,pdcpBytesUl\",\n        \"outputDataType\": \"c, d\",\n        \"targetEnvironment\": [\n            {\n                \"platformName\": \"abc\",\n                \"environmentType\": \"env\",\n                \"dependencyList\": \"a,b,c\"\n            }\n        ]\n    }\n}\u0027\n\n```\n\nB: Observed error from MME logs:\n```bash\n2025/09/01 10:37:07 /home/app/models/modelInfo.go:86 ERROR: column \"model_related_information_id\" does not exist (SQLSTATE 42703)\n[0.187ms] [rows:0] DELETE FROM target_environments WHERE model_related_information_id \u003d \u00272ea20500-2a7c-4a35-825e-3423e91c873e\u0027\n2025/09/01 10:37:07 /home/app/db/modelInfoRepository.go:37 ERROR: column \"model_related_information_id\" does not exist (SQLSTATE 42703)\n[1.092ms] [rows:1] INSERT INTO \"model_related_informations\" (\"id\",\"model_name\",\"model_version\",\"artifact_version\",\"description\",\"author\",\"owner\",\"input_data_type\",\"output_data_type\",\"model_location\") VALUES (\u00272ea20500-2a7c-4a35-825e-3423e91c873e\u0027,\u0027test-model-target-env\u0027,\u00271\u0027,\u00270.0.0\u0027,\u0027hello world2\u0027,\u0027someone\u0027,\u0027\u0027,\u0027pdcpBytesDl,pdcpBytesUl\u0027,\u0027c, d\u0027,\u0027\u0027)\ntime\u003d2025-09-01T10:37:07.469Z level\u003dINFO source\u003d/home/app/logging/logging.go:54 msg\u003derror app\u003dmmes !BADKEY\u003d\"ERROR: column \\\"model_related_information_id\\\" does not exist (SQLSTATE 42703)\"\ntime\u003d2025-09-01T10:37:07.469Z level\u003dINFO source\u003d/home/app/logging/logging.go:44 msg\u003d\"model is saved.\" app\u003dmmes\n[GIN] 2025/09/01 - 10:37:07 | 201 |    1.622349ms |        10.0.0.7 | POST     \"/ai-ml-model-registration/v1/model-registrations\"\n```\n\n\nC: Analysis of the issue:\nUpon further debugging, I found the root cause:\nIn main.go, `AutoMigrate(\u0026models.TargetEnvironment{})` is being called.\nThis creates the table with only three columns: `platform_name, environment_type, and dependency_list`.\nHowever, the SQL queries highlighted here assume the presence of an additional column, model_related_information_id, which does not exist in the migrated schema.\nAs a result, the registration step fails.\n\nCan you verify on your end, and resolve the issue?",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0a058bf1_7d1a728f",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1002769
      },
      "writtenOn": "2025-09-06T00:18:14Z",
      "side": 1,
      "message": "Thanks for the review. \n\nTo keep the spec-compliant TargetEnvironment (with only platformName, environmentType, and dependencyList), would it be acceptable to introduce an internal-only DB struct named TargetEnvironmentRow that includes a ModelRelatedInformationID foreign key for persistence (used only by AutoMigrate/CRUD), while leaving the public API schema unchanged?",
      "parentUuid": "3d7cd341_3cd1b73f",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f7d05e94_753333ba",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1000475
      },
      "writtenOn": "2025-09-09T11:06:13Z",
      "side": 1,
      "message": "`TargetEnvironment` is an optional field, so I feel adding DB structure does not make sense if we don\u0027t offer the API.\n\nYou could take this approach to make this field optional in API and also make DB structure to handle this optional field",
      "parentUuid": "0a058bf1_7d1a728f",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82251636_bde63d0a",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1000475
      },
      "writtenOn": "2025-09-12T08:32:00Z",
      "side": 1,
      "message": "Hello @Minje, could you please let me know if you would like to expose the `TargetEnvironment` as part of API in subsequent patch.\n\nLet me know your implementation for `TargetEnvironmentRow` we could accommodate any internal fields to this table as it is not exposed to consumer.\n\nexposed API\u0027s are important in context of spec compliancy, as it is available to consuserm.\n\nNote: please validate the changes as per the comments from @Ashish.",
      "parentUuid": "f7d05e94_753333ba",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "51809eab_a87e6e67",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1002769
      },
      "writtenOn": "2025-09-29T02:16:38Z",
      "side": 1,
      "message": "Sorry for the late reply—this week was a critical one at work. Quick check: is it okay if we keep targetEnvironment optional in the public API and introduce an internal-only TargetEnvironmentRow for persistence?\n\nTargetEnvironmentRow fields\n - id (PK, uuid)\n - model_related_information_id (FK → ModelRelatedInformation.Id, ON DELETE CASCADE)\n - platform_name\n - environment_type\n - dependency_list\n\nIf this direction looks good, I’ll proceed accordingly. If you have a better approach in mind, I’d really appreciate your thoughts. Thanks!",
      "parentUuid": "82251636_bde63d0a",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "42e609c3_f181a59b",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1001948
      },
      "writtenOn": "2025-09-29T06:35:29Z",
      "side": 1,
      "message": "Hi Minje,\n\nI agree with the approach of using the following fields for TargetEnvironmentRow:\n1. id (PK, uuid)\n2. model_related_information_id (FK → ModelRelatedInformation.Id, ON DELETE CASCADE)\n3. platform_name\n4. environment_type\n5. dependency_list\n\nMy suggestion would be not to create a new table named TargetEnvironmentRow, but instead modify the `existing TargetEnvironment` model by adding the `id` and `model_related_information_id` fields.\n\nRegarding spec compliance, we won’t expose `id` or `model_related_information_id` to users.\nWhen a user registers a model, they will only provide three fields: `platform_name, environment_type, and dependency_list`. We will handle the generation of id and model_related_information_id internally.\n\nSince users will have no control over these fields, the implementation will remain spec-compliant.\n\nKindly, let me know, If you have any other comment.",
      "parentUuid": "51809eab_a87e6e67",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8b4c4d58_6203cd93",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1002769
      },
      "writtenOn": "2025-10-10T17:43:16Z",
      "side": 1,
      "message": "Thanks a lot for the detailed review, Ashish!\n\nI’ve updated the patch per your suggestion—no separate TargetEnvironmentRow; I extended the existing TargetEnvironment with internal‐only ID and ModelRelatedInformationID (both json:\"-\"), so the public API remains unchanged. CRUD tests pass, and AutoMigrate creates the 5-column target_environments table.\n\nOne migration question: existing deployments may already have target_environments rows without id / model_related_information_id. How would you prefer we handle this?\n  - add the two columns and populate model_related_information_id (I can provide DDL/backfill script, plus optional FK/index).\n  - move legacy rows to a read-only _orphan table and keep only new rows in the main table.\n  - No legacy data\n\nThanks again for the thorough feedback!",
      "parentUuid": "42e609c3_f181a59b",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1758905_5d62ba88",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 92,
      "author": {
        "id": 1000065
      },
      "writtenOn": "2025-10-13T00:38:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8b4c4d58_6203cd93",
      "range": {
        "startLine": 92,
        "startChar": 37,
        "endLine": 92,
        "endChar": 65
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cec42709_ca2f2e5e",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1001948
      },
      "writtenOn": "2025-09-01T11:48:13Z",
      "side": 1,
      "message": "Further, once you make the changes, please validate them using the following APIs:\n1. Model Registration\nValidation: The model should be created successfully and returned in the response.\n```bash\ncurl --location \u0027localhost:32006/ai-ml-model-registration/v1/model-registrations/\u0027 \\\n--header \u0027Content-Type: application/json\u0027 \\\n--data \u0027{\n    \"modelId\": {\n        \"modelName\": \"test-model-target-env\",\n        \"modelVersion\" : \"1\"\n    },\n    \"description\": \"hello world2\",\n    \"modelInformation\": {\n        \"metadata\": {\n            \"author\": \"someone\"\n        },\n        \"inputDataType\": \"pdcpBytesDl,pdcpBytesUl\",\n        \"outputDataType\": \"c, d\",\n        \"targetEnvironment\": [\n            {\n                \"platformName\": \"abc\",\n                \"environmentType\": \"env\",\n                \"dependencyList\": \"a,b,c\"\n            }\n        ]\n    }\n}\u0027\n```\n\n\n2. Get All Models\nValidation: The response should list all models that have been created.\n```bash\ncurl --location \u0027localhost:32006/ai-ml-model-discovery/v1/models\u0027\n```\n\n\n\n3. Get Single Model (by name \u0026 version)\nValidation: The response should include the model registered in Step 1.\n```bash\ncurl --location \u0027localhost:32006/ai-ml-model-discovery/v1/models?model-name\u003dtest-model-target-env\u0026model-version\u003d1\u0027\n```\n\n\n4. Get Single Model (by ID)\nValidation: The response should return the same model created in Step 1.\n```bash\ncurl --location \u0027localhost:32006/ai-ml-model-registration/v1/model-registrations/\u003cMODEL_ID\u003e\u0027\n```\n(Replace \u003cMODEL_ID\u003e with the id returned in Step 1)\n\n\n\n5. Delete Model \u0026 Verify Deletion\nValidation: The model should no longer be retrievable after deletion.\n\n```bash\ncurl --location --request DELETE \u0027localhost:32006/ai-ml-model-registration/v1/model-registrations/\u003cMODEL_ID\u003e\u0027\n\ncurl --location \u0027localhost:32006/ai-ml-model-registration/v1/model-registrations/\u003cMODEL_ID\u003e\u0027\n```",
      "range": {
        "startLine": 93,
        "startChar": 20,
        "endLine": 93,
        "endChar": 32
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b0d89889_b47959e6",
        "filename": "models/modelInfo.go",
        "patchSetId": 3
      },
      "lineNbr": 93,
      "author": {
        "id": 1000475
      },
      "writtenOn": "2025-10-13T10:10:14Z",
      "side": 1,
      "message": "Acknowledged",
      "parentUuid": "cec42709_ca2f2e5e",
      "range": {
        "startLine": 93,
        "startChar": 20,
        "endLine": 93,
        "endChar": 32
      },
      "revId": "0adb9ed8b2d11692befc93f9f28bc2570de38182",
      "serverId": "84e4e190-e623-4c37-9eda-58b1937c1b53"
    }
  ]
}